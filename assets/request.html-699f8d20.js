import{k as j,ah as U,bh as z,d as q,h as m,o as u,D as _,w as a,a as o,e as i,u as t,G as k,aj as h,N as v,_ as b,r as B,c as R}from"./app-e292fa4a.js";import{N as g}from"./Button-cf6a4486.js";import{N as y}from"./Alert-f4e0c99f.js";import{N as A}from"./Image-7d82cbcb.js";import"./browser-a651c2a9.js";import"./color-to-class-b0332f36.js";import"./resolve-slot-0734e74d.js";import"./Popover-541833c9.js";import"./map-095a7ba8.js";import"./getTag-40b4537f.js";import"./Scrollbar-c866deda.js";import"./utils-a41db74b.js";import"./use-false-until-truthy-48ace831.js";import"./use-merged-state-25935a72.js";import"./arrayReduce-865b0d3f.js";function I(){const p=j(z,null);return p===null&&U("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),p}const S="https://alist.nn.ci/tool/aliyundrive/callback",Q="76917ccccd4441c39457a04f6084fb2f",N="https://api.nn.ci",T=q({__name:"Request",setup(p){function w(){const e=new URL("https://open.aliyundrive.com/oauth/authorize");e.searchParams.set("client_id",Q),e.searchParams.set("redirect_uri",S),e.searchParams.set("scope","user:base,file:all:read,file:all:write"),e.searchParams.set("response_type","code"),e.searchParams.set("state",""),window.open(e.toString(),"_blank")}const s=m(),l=m(!1);async function P(){try{l.value=!0;const n=await(await fetch(N+"/alist/ali_open/qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})})).json();s.value=n}catch(e){console.log(e),s.value={error:"error",qrCodeUrl:"",sid:""}}finally{l.value=!1}}const d=m(),f=m(!1),C=I();async function x(){var e;try{f.value=!0;const r=await(await fetch(`${N}/proxy/https://open.aliyundrive.com/oauth/qrcode/${(e=s.value)==null?void 0:e.sid}/status`)).json();if(d.value=r,r.status==="LoginSuccess"){const c=new URL(S);c.searchParams.set("code",r.authCode),window.open(c.toString(),"_blank")}else C.warning(r.status)}catch(n){console.log(n),C.error(String(n))}finally{f.value=!1}}return(e,n)=>(u(),_(t(v),{vertical:"",size:"large"},{default:a(()=>{var r,c;return[o(t(g),{size:"large",type:"primary",onClick:w,block:""},{default:a(()=>[i("Go to login")]),_:1}),o(t(g),{size:"large",type:"info",onClick:P,block:"",loading:l.value,disabled:!!s.value},{default:a(()=>[i("Scan QrCode ")]),_:1},8,["loading","disabled"]),(r=s.value)!=null&&r.error?(u(),_(t(y),{key:0,title:"Error",type:"error"},{default:a(()=>[i(k(s.value.error),1)]),_:1})):h("v-if",!0),(c=s.value)!=null&&c.qrCodeUrl?(u(),_(t(v),{key:1,vertical:""},{default:a(()=>[o(t(v),{justify:"center"},{default:a(()=>[o(t(A),{width:"300",src:s.value.qrCodeUrl},null,8,["src"])]),_:1}),o(t(y),{title:"Scan the QrCode",type:"info"},{default:a(()=>[i("Use AliyunDrive APP To Scan Then Click the Button Below")]),_:1}),o(t(g),{size:"large",onClick:x,type:"info",block:"",loading:f.value},{default:a(()=>[i("I have scan")]),_:1},8,["loading"])]),_:1})):h("v-if",!0),d.value&&d.value.status!=="LoginSuccess"?(u(),_(t(y),{key:2,title:"Warning",type:"warning"},{default:a(()=>[i(k(d.value.status),1)]),_:1})):h("v-if",!0)]}),_:1}))}});const L=b(T,[["__scopeId","data-v-21249173"],["__file","Request.vue"]]),D=q({__name:"request.html",setup(p){return(w,s)=>{const l=B("NaiveClient");return u(),R("div",null,[o(l,null,{default:a(()=>[o(t(L))]),_:1})])}}}),te=b(D,[["__file","request.html.vue"]]);export{te as default};
